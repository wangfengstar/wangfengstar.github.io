---
layout: post
title: JDK SPI源码思路分析
categories: java编程
description: JDK SPI源码思路分析
keywords: java编程
---

# 1.组织
1）Linux基金会

目标：是推动Linux发展，Xen、KVM、CNCF等都来自Linux基金会。华为OpenSDS项目为不同的云、容器、虚拟化等环境创建一个通用开放的SDS（Software Defined Storage）解决方案，提供灵活的按需数据存储服务。

LFN：Linux基金会旗下的ONAP、OPNFV、OpenDaylight、FD.IO、PDNA、SNAS等网络开源项目合作成立跨项目合作的LFN（LF Networkong Fund）。

2）OpenStack基金会

目标：是推进OpenStack开发、发布以及能作为云操作系统被采纳，并服务所有会员。为OpenStack的开发者、用户和生态系统提供服务，通过资源共享，推进OpenStack公有、私有云的发展，辅助技术提供商在OpenStack中集成新兴技术，帮助开发出更好的云计算软件。

3）Apache基金会

# 2. SDN发展历史
软件定义网络（Software Defined Network，SDN）是由美国斯坦福大学clean-slate课题研究组提出的一种新型网络创新架构，是网络虚拟化的一种实现方式。其核心技术OpenFlow通过将网络设备的控制面与数据面分离开来，从而实现了网络流量的灵活控制，使网络作为管道变得更加智能，为核心网络及应用的创新提供了良好的平台。
## 2.1 OpenFlow
OpenFlow起源于斯坦福大学的Clean State项目组，该项目组通过OpenFlow将控制逻辑从网络设备中剥离出来，形成如下的架构：
![clipboard](5FDDCFF9377B4B108320433298529BBF)

### 核心思想
将传统的网络设备的数据平面Data Plane（数据转发）和控制平面Control Plane相分离，通过集中式的控制器Controller以标注化的接口对各种网络设备进行管理和配置，将为网络资源的设计、管理、使用提供更多的可能性，推动网络的革新和发展。
### 版本演进
1.0版本，奠定OpenFlow协议的基础。

1.1、1.2版本，优化了交换机有很大的TCAM表项的问题，引入Group和Multi Table概念。

1.3版本，特性更丰富，主要增加Meter和QOS，可以对网络带宽进行限速并进行有效管理，保证服务质量。
### 应用场景
1）网络虚拟化
FlowVisor网络虚拟化，本质是对底层网络的物理拓扑进行抽象，逻辑上对网络资源进行分片和整合，满足各类应用对网络的不同需求。

![clipboard](13EB1F2B36D54F16AFBB6CFBA2D5642B)

FlowVisor实现了一个特殊的OpenFlow Controller，可以看作使用不同用户或应用的Controller与网络设备之间的一层代理，不同用户或者应用可以使用自己的Controller来定义不同网络拓扑，FlowVisor来保证他们之间的隔离且互不影响。

2）安全和访问控制

3）负载均衡

![clipboard](1B6CDA163A5947F38688435CEC64B7BF)

传统的负载均衡在服务器集群的入口处，通过一个gateway监测、统计服务器的工作负载，据此将用户的请求动态的分配到负载相对较轻的服务器。

网络中一旦所有设备都可以通过OpenFlow进行集中式的管控，同时服务器的负载又可以及时反馈给OpenFlow Controller，那OpenFlow就非常适合做负载均衡工作。

在Aster*x中通过Host Manager和Net Manager分别监测服务器和网络的工作负载，将这些信息反馈给Flow Manager，Flow Manager可以根据这些实时负载信息，重新定义网络设备上的OpenFlow规则，将用户请求按照服务器的能力进行调整和分发。

4）绿色节能

5）传统网络设备交互和整合
## 2.2 SDN提出
基于OpenFlow为网络带来的可编程性，斯坦福教授Nick McKeown和其团队提出了SDN的概念。
### 核心思想
SDN的核心思想是将控制功能从交换机中剥离出来，形成统一的、集中式的控制平面，交换机只保留简单的转发功能（数据平面）。

通过控制平面对数据平面进行集中化控制，SDN为网络提供了开放的编程接口，实现灵活的可编程能力，让网络可以被软件定义，提供按需定制服务，简化网络运维和管理调度的目标。
### SDN基础架构

![clipboard](4476612D6C3448C4AC73F872E7CEF87C)

1.基础设施层

主要承担数据转发功能，由各类网络设备构成，比如数据中心的网络路由器，支持OpenFlow的硬件交换机等。

2.控制层

网络转发的控制管理平面，负责管理网络的基础设施，主要组成部分为SDN控制器。SDN控制器是整个网络的大脑、控制中心，主要按照配置的业务逻辑，产生对应的数据平面的流转发规则，下发给网络设备，控制其进行数据转发。

3.应用层

应用层主要通过SDN提供的北向接口，通过北向接口实现应用和网络的联动，比如网络拓扑的编排、监控等。

4.接口层

南向接口：

SDN控制器对网络的控制主要通过OpenFlow、NetConf等南向接口实现，包括链路发现，拓扑管理、策略制定、表项下发等。

北向接口：

北向接口通过控制器向上层应用开放的接口，目标是使得应用能够便利的调用底层的网络资源和能力。北向接口直接为应用服务。

### SDN实现
SDN需要某种方法使得控制平面和数据平面进行通信，OpenFlow是一种方法机制，但是并非实现SDN唯一方法。

1）IETF定义开放SDN架构

![1603282664(1)](225E89BBF9B54952A64DF1068600B6DA)

核心思想：

重用当前的技术而非OpenFlow，如利用Netconf和已有的设备接口，Netconf使用xml来配置设备，减少与自动化设备配置有关的编程工作量。
这种架构的思路充分利用现有的设备，更大限度的保障已有投资。

2）Overlay网络技术

![clipboard](03905B9F97424E53B87D9CDFBB7C0C62)

**核心思想：**

在现行的物理IP网络基础上建设叠加逻辑网络Overlay Logical Network，屏蔽底层物理网络差异，实现网络资源的虚拟化，是的多个逻辑上彼此隔离的网络分区，以及多种异构的虚拟网络可以在同一共享的物理网络基础设施上共存。
Overlay是网络就上叠加的虚拟化技术模式，在已有的网络上的虚拟网，由逻辑节点和逻辑链路构成。Overlay网络主要思想可以被归纳为解耦、独立、控制三个方面。

**优势：**

Overlay网络叠加实现技术包括VXLAN、NVP等，主要由虚拟化厂商所主导，比如vmware在虚拟化平台中实现的VxLAN技术，微软的虚拟化平台实现的NVGRE技术。

3）基于专用接口
基于专用接口的方案实习思路是不改变传统网络的实现机制和工作方式，通过对现有的网络设备操作系统进行升级改造，在网络设备上专门开发出专用的API接口，管理人员可以通过API接口实现网络设备的统一配置管理和下发，改变原先需要一台台设备登录配置和手工操作方式，这些接口也可以供用户开发网络应用，实现网络设备的可编程。

典型的基于专用接口的SDN实现方案是思科ONE架构。

##  P4
SDN：解决方案将控制平面与转发平面分离提供了控制平面的可编程能力。（现有的SDN为用户开放的是控制平面可编程能力，转发平面数据包的解析转发流程是由设备转发芯片固话的，设备在协议的支持方面不具有扩展能力。）

P4：为了解决转发层面的标准化的问题，让转发平面也具有可编程的能力，让软件定义网络和网络设备。让数据包的解析和转发流程也能通过编程去控制，使得网络及设备自上而下的真正向用户开放。

![微信图片_20201112232420](411BA930706B42C2B67FC550D38D7EDA)

P4解决数据平面的可编程的问题，是一门用于数据平面的编程语言，类比c语言：

- c语言程序代码---> gcc或其它编译器 ---->可执行文件，运行在x86 cpu、ARM上；
- P4语言代码----> P4编译器 ----> 硬件或其它输出形式，运行在cpu、fpga、asic上；
